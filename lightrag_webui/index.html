<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lightrag</title>
    <script>
      (function() {
        try {
          var storageKey = 'settings-storage';
          var defaultTheme = 'system';
          var classNameDark = 'dark';
          var classNameLight = 'light';

          function getTheme() {
            try {
              var item = localStorage.getItem(storageKey);
              if (item) {
                var parsed = JSON.parse(item);
                if (parsed && parsed.state && parsed.state.theme) {
                  return parsed.state.theme;
                }
              }
            } catch (e) {
              console.error('Error parsing theme settings:', e);
            }
            return defaultTheme;
          }

          var theme = getTheme();
          var root = document.documentElement;

          root.classList.remove(classNameLight, classNameDark);

          if (theme === 'system') {
            var systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? classNameDark : classNameLight;
            root.classList.add(systemTheme);
          } else {
            root.classList.add(theme);
          }
        } catch (e) {
          console.error('Theme initialization failed:', e);
        }
      })();
    </script>
  </head>
  <body>
    <div id="root">
      <style>
        :root {
          --initial-bg: hsl(0 0% 100%);
          --initial-fg: hsl(240 10% 3.9%);
        }
        :root.dark {
          --initial-bg: hsl(240 10% 3.9%);
          --initial-fg: hsl(0 0% 98%);
        }
        html, body {
          background-color: var(--initial-bg);
          color: var(--initial-fg);
          margin: 0;
          padding: 0;
          transition: background-color 0.2s ease;
        }
        .initial-loader { 
          display: flex; 
          flex-direction: column; 
          align-items: center; 
          justify-content: center; 
          height: 100vh; 
          font-family: system-ui, sans-serif; 
          background-color: var(--initial-bg);
          color: var(--initial-fg);
        }
        .spinner { width: 40px; height: 40px; border: 4px solid var(--initial-fg); border-top: 4px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; opacity: 0.5; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #startup-error { display: none; color: #dc2626; padding: 20px; max-width: 600px; margin: 0 auto; background: #fee2e2; border-radius: 8px; margin-top: 20px; font-family: monospace; }
      </style>
      <div class="initial-loader">
        <div class="spinner"></div>
        <p>Initializing LightRAG...</p>
        <div id="startup-error"></div>
      </div>
    </div>
    <script>
      window.onerror = function(msg, url, line, col, error) {
        const errorDiv = document.getElementById('startup-error');
        if (errorDiv) {
          errorDiv.style.display = 'block';
          errorDiv.innerHTML = '<strong>Startup Error:</strong><br/>' + msg + '<br/><small>' + url + ':' + line + '</small>';
        }
      };
    </script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
